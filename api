// المسار: /api/generate.js

export default async function handler(request, response) {
  // التأكد من أن الطلب هو POST
  if (request.method !== 'POST') {
    return response.status(405).json({ error: 'Method not allowed' });
  }

  // استلام اسم المنتج من الواجهة الأمامية
  const { productName } = request.body;
  const apiKey = process.env.HF_API_KEY; // المفتاح السري من إعدادات فيرسل

  if (!apiKey) {
    return response.status(500).json({ error: 'API Key missing' });
  }

  try {
    // الاتصال بـ Hugging Face (موديل Mistral المجاني والقوي)
    const result = await fetch(
      "https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.2",
      {
        headers: {
          Authorization: `Bearer ${apiKey}`,
          "Content-Type": "application/json",
        },
        method: "POST",
        body: JSON.stringify({
          inputs: `Write a short, professional sales description in Arabic for a product named: ${productName}. Focus on features and quality.`,
          parameters: { 
            max_new_tokens: 300, // عدد الكلمات
            return_full_text: false,
            temperature: 0.7 // للإبداع
          } 
        }),
      }
    );

    const data = await result.json();
    
    // إرسال النتيجة للواجهة الأمامية
    return response.status(200).json({ 
      description: data[0]?.generated_text || "فشل التوليد، حاول مرة أخرى." 
    });

  } catch (error) {
    return response.status(500).json({ error: 'Error connecting to AI' });
  }
}
